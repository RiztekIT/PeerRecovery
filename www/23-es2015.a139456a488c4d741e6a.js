(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{Wrxl:function(n,l,t){"use strict";t.r(l);var e=t("8Y7J");class o{}var s=t("pMnS"),u=t("SVse"),i=t("MKJQ"),a=t("sZkV"),c=t("s7LF"),r=t("lGQG"),g=t("sjK5"),h=t("yp2w");class b{constructor(n,l,t,e,o,s,u){this.nav=n,this.route=l,this.router=t,this.firebaseAuthService=e,this.chatService=o,this.http=s,this.http2=u,this.ID_Chat="",this.message="",this.chatMessages=[],this.messages=[],this.route.queryParams.subscribe(n=>{if(n&&n.data){let l=JSON.parse(n.data);l=JSON.parse(l),this.parametros=!0,this.chatService.keymessage=l.key,this.chatUser=l.chatuser}})}ngOnInit(){this.user=JSON.parse(sessionStorage.getItem("user")),this.parametros||(this.chatUser=this.chatService.user2,console.log(this.chatUser,"USER")),this.getMessages()}getUserWith(){JSON.parse(localStorage.getItem("user2"))?(this.chatUser=JSON.parse(localStorage.getItem("user2")),console.log(this.chatUser)):(this.chatUser=JSON.parse(localStorage.getItem("users2")),console.log(this.chatUser))}ngOnDestroy(){this.chatService.stopread()}getChat(){}sendMessage(){console.log(this.message),console.log(this.message),this.chatService.sendMessage(this.message,this.firebaseAuthService.usersign,this.chatUser),this.message="",this.chatService.getTokenID(this.chatUser.uid).once("value",n=>{console.log(n.val(),"USERS"),this.sendMessageNoti(this.message,this.chatService.keymessage,n.val(),this.chatUser)})}sendMessageNoti(n,l,t,e){let o={key:l,m:n,user:e};console.log(o,"data"),console.log(t,"U"),this.http2.post("https://fcm.googleapis.com/fcm/send",{notification:{title:"PeerRecovery",body:"New Message",sound:"default",click_action:"FCM_PLUGIN_ACTIVITY",icon:"fcm_push_icon"},data:{landing_page:"chat",data:o},to:t,priority:"high",restricted_package_name:""},{headers:{Authorization:"key=AAAA7CwLHfI:APA91bGdbyFJFwO4xWEBilRVInU37vOoQ5jURZv0PHbD8zXc4pT58GEy1ETkskaOfIJEhHtR4YYMr4SbDRiuEI7BJG0JfoXDbguV691brsZri_bLqMQLc-FWffr1EakQsurEnb0ZrN2_","Content-Type":"application/json"}}).subscribe(n=>{console.log(n)})}goToChatList(){this.nav.navigateBack("/chat"),localStorage.removeItem("user2"),localStorage.removeItem("users2"),localStorage.removeItem("idchat")}scrollToBottom(){this.content.scrollToBottom(300)}eventoMensaje(n){console.log(n),13==n&&this.sendMessage()}getMessages(){this.chatService.getMessages().orderByChild("timestamp").on("value",n=>{this.messages=[],n.forEach(n=>{let l=n.val();console.log(n.val()),this.chatService.getUser(l.sender).on("value",n=>{l.senderuser=n.val(),this.messages.push(l),this.chatMessages=this.messages}),setTimeout(()=>{this.scrollToBottom()},500)}),console.log(this.messages)}),this.chatService.cleanUnread(this.user.uid,this.chatService.keymessage)}}var d=t("iInd"),m=t("IheW"),p=e.pb({encapsulation:0,styles:[["ion-header[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]{color:var(--blue)}ion-header[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:var(--blue);text-align:center;font-size:18px;font-family:sf_ui_sb;text-transform:capitalize}ion-content[_ngcontent-%COMP%]   .td_lbl[_ngcontent-%COMP%]{font-size:12px;color:var(--blue);font-family:sf_ui_md;text-align:center;margin-top:12px;margin-bottom:12px}ion-content[_ngcontent-%COMP%]   .chat_div[_ngcontent-%COMP%]{display:flex;margin-bottom:20px;align-items:center}ion-content[_ngcontent-%COMP%]   .chat_div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:57px;width:57px;border-radius:50%;border:solid 3px var(--white);box-shadow:0 0 5px 0 rgba(31,140,237,.25)}ion-content[_ngcontent-%COMP%]   .chat_div[_ngcontent-%COMP%]   .message_div[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{width:230px;box-shadow:0 0 3px 0 rgba(0,0,0,.3);padding:15px;margin-left:15px;border-radius:5px}ion-content[_ngcontent-%COMP%]   .chat_div[_ngcontent-%COMP%]   .message_div[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]   .chat_lbl[_ngcontent-%COMP%]{font-size:14px;color:var(--blue);font-family:sf_ui_md_i;margin-top:0;margin-bottom:5px}ion-content[_ngcontent-%COMP%]   .chat_div[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:12px;color:var(--lht_blue);font-family:sf_ui_md;margin-top:8px;margin-bottom:0;text-align:end}ion-content[_ngcontent-%COMP%]   .replay_div[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}ion-content[_ngcontent-%COMP%]   .replay_div[_ngcontent-%COMP%]   .message_div[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{width:250px;margin-right:15px;margin-left:0;background-color:var(--my_theme);box-shadow:none}ion-content[_ngcontent-%COMP%]   .replay_div[_ngcontent-%COMP%]   .message_div[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]   .chat_lbl[_ngcontent-%COMP%]{color:var(--white)}ion-content[_ngcontent-%COMP%]   .replay_div[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{text-align:start}ion-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;box-shadow:0 -1px 6px 0 rgba(0,0,0,.2)}ion-footer[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{width:100%}ion-footer[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{font-size:12px;font-family:rubik_i;color:var(--gray)}ion-footer[_ngcontent-%COMP%]   .send_btn[_ngcontent-%COMP%]{height:50px;width:50px;--background:var(--my_theme);margin:0;--border-radius:0px;min-width:50px;--padding-start:0;--padding-end:0}ion-footer[_ngcontent-%COMP%]   .send_btn[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:27px;height:27px}"]],data:{}});function _(n){return e.Mb(0,[(n()(),e.rb(0,0,null,null,7,"div",[["class","chat_div "]],null,null,null,null,null)),(n()(),e.rb(1,0,null,null,6,"div",[["class","message_div "]],null,null,null,null,null)),(n()(),e.rb(2,0,null,null,2,"div",[["class","chat "]],null,null,null,null,null)),(n()(),e.rb(3,0,null,null,1,"p",[["class","chat_lbl "]],null,null,null,null,null)),(n()(),e.Kb(4,null,["",""])),(n()(),e.rb(5,0,null,null,2,"p",[["class","time "]],null,null,null,null,null)),(n()(),e.Kb(6,null,["",""])),e.Gb(7,2)],null,(function(n,l){n(l,4,0,l.parent.context.$implicit.message);var t=e.Lb(l,6,0,n(l,7,0,e.Cb(l.parent.parent,0),1e3*l.parent.context.$implicit.timestamp.seconds,"dd/MM/yy h:mm a"));n(l,6,0,t)}))}function v(n){return e.Mb(0,[(n()(),e.rb(0,0,null,null,7,"div",[["class","chat_div replay_div "]],null,null,null,null,null)),(n()(),e.rb(1,0,null,null,6,"div",[["class","message_div "]],null,null,null,null,null)),(n()(),e.rb(2,0,null,null,2,"div",[["class","chat "]],null,null,null,null,null)),(n()(),e.rb(3,0,null,null,1,"p",[["class","chat_lbl "]],null,null,null,null,null)),(n()(),e.Kb(4,null,["",""])),(n()(),e.rb(5,0,null,null,2,"p",[["class","time "]],null,null,null,null,null)),(n()(),e.Kb(6,null,["",""])),e.Gb(7,2)],null,(function(n,l){n(l,4,0,l.parent.context.$implicit.message);var t=e.Lb(l,6,0,n(l,7,0,e.Cb(l.parent.parent,0),1e3*l.parent.context.$implicit.timestamp.seconds,"dd/MM/yy h:mm a"));n(l,6,0,t)}))}function f(n){return e.Mb(0,[(n()(),e.rb(0,0,null,null,4,"div",[],null,null,null,null,null)),(n()(),e.gb(16777216,null,null,1,null,_)),e.qb(2,16384,null,0,u.k,[e.O,e.K],{ngIf:[0,"ngIf"]},null),(n()(),e.gb(16777216,null,null,1,null,v)),e.qb(4,16384,null,0,u.k,[e.O,e.K],{ngIf:[0,"ngIf"]},null)],(function(n,l){var t=l.component;n(l,2,0,l.context.$implicit.sender!=t.firebaseAuthService.usersign.uid),n(l,4,0,l.context.$implicit.sender==t.firebaseAuthService.usersign.uid)}),null)}function C(n){return e.Mb(0,[e.Eb(0,u.e,[e.s]),e.Ib(671088640,1,{content:0}),(n()(),e.rb(2,0,null,null,15,"ion-header",[["class","ion-no-border"]],null,null,null,i.eb,i.q)),e.qb(3,49152,null,0,a.B,[e.h,e.k,e.x],null,null),(n()(),e.rb(4,0,null,0,13,"ion-toolbar",[["mode","md"]],null,null,null,i.Bb,i.N)),e.qb(5,49152,null,0,a.zb,[e.h,e.k,e.x],{mode:[0,"mode"]},null),(n()(),e.rb(6,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,i.T,i.f)),e.qb(7,49152,null,0,a.l,[e.h,e.k,e.x],null,null),(n()(),e.rb(8,0,null,0,2,"ion-back-button",[["defaultHref","chatList"],["icon","chevron-back-outline"],["mode","md"],["text",""]],null,[[null,"click"]],(function(n,l,t){var o=!0,s=n.component;return"click"===l&&(o=!1!==e.Cb(n,10).onClick(t)&&o),"click"===l&&(o=!1!==s.goToChatList()&&o),o}),i.Q,i.c)),e.qb(9,49152,null,0,a.g,[e.h,e.k,e.x],{defaultHref:[0,"defaultHref"],icon:[1,"icon"],mode:[2,"mode"],text:[3,"text"]},null),e.qb(10,16384,null,0,a.h,[[2,a.fb],a.Gb,a.d],{defaultHref:[0,"defaultHref"]},null),(n()(),e.rb(11,0,null,0,3,"ion-buttons",[["slot","end"]],null,null,null,i.T,i.f)),e.qb(12,49152,null,0,a.l,[e.h,e.k,e.x],null,null),(n()(),e.rb(13,0,null,0,1,"ion-menu-button",[],null,null,null,i.lb,i.y)),e.qb(14,49152,null,0,a.R,[e.h,e.k,e.x],null,null),(n()(),e.rb(15,0,null,0,2,"ion-title",[],null,null,null,i.zb,i.L)),e.qb(16,49152,null,0,a.xb,[e.h,e.k,e.x],null,null),(n()(),e.Kb(-1,0,["chat"])),(n()(),e.rb(18,0,null,null,4,"ion-header",[],null,null,null,i.eb,i.q)),e.qb(19,49152,null,0,a.B,[e.h,e.k,e.x],null,null),(n()(),e.rb(20,0,null,0,2,"ion-title",[],null,null,null,i.zb,i.L)),e.qb(21,49152,null,0,a.xb,[e.h,e.k,e.x],null,null),(n()(),e.Kb(22,0,["",""])),(n()(),e.rb(23,0,null,null,0,"hr",[],null,null,null,null,null)),(n()(),e.rb(24,0,null,null,3,"ion-content",[["class","ion-padding-horizontal"]],null,null,null,i.X,i.j)),e.qb(25,49152,[[1,4],["chatcontent",4]],0,a.u,[e.h,e.k,e.x],{scrollEvents:[0,"scrollEvents"]},null),(n()(),e.gb(16777216,null,0,1,null,f)),e.qb(27,278528,null,0,u.j,[e.O,e.K,e.q],{ngForOf:[0,"ngForOf"]},null),(n()(),e.rb(28,0,null,null,14,"ion-footer",[["class","ion-no-border "]],null,null,null,i.cb,i.o)),e.qb(29,49152,null,0,a.z,[e.h,e.k,e.x],null,null),(n()(),e.rb(30,0,null,0,8,"ion-item",[["lines","none "],["mode","md"]],null,null,null,i.hb,i.t)),e.qb(31,49152,null,0,a.H,[e.h,e.k,e.x],{lines:[0,"lines"],mode:[1,"mode"]},null),(n()(),e.rb(32,0,null,0,6,"ion-input",[["placeholder","Type your message... "],["style","font-size: 20px !important;"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"keypress"],[null,"ionBlur"],[null,"ionChange"]],(function(n,l,t){var o=!0,s=n.component;return"ionBlur"===l&&(o=!1!==e.Cb(n,33)._handleBlurEvent(t.target)&&o),"ionChange"===l&&(o=!1!==e.Cb(n,33)._handleInputEvent(t.target)&&o),"ngModelChange"===l&&(o=!1!==(s.message=t)&&o),"keypress"===l&&(o=!1!==s.eventoMensaje(t.keyCode)&&o),o}),i.gb,i.s)),e.qb(33,4341760,null,0,a.Nb,[e.p,e.k],null,null),e.Hb(1024,null,c.f,(function(n){return[n]}),[a.Nb]),e.qb(35,671744,null,0,c.k,[[8,null],[8,null],[8,null],[6,c.f]],{model:[0,"model"]},{update:"ngModelChange"}),e.Hb(2048,null,c.g,null,[c.k]),e.qb(37,16384,null,0,c.h,[[4,c.g]],null,null),e.qb(38,49152,null,0,a.G,[e.h,e.k,e.x],{placeholder:[0,"placeholder"]},null),(n()(),e.rb(39,0,null,0,3,"ion-button",[["class","send_btn"]],null,[[null,"click"]],(function(n,l,t){var e=!0;return"click"===l&&(e=!1!==n.component.sendMessage()&&e),e}),i.S,i.e)),e.qb(40,49152,null,0,a.k,[e.h,e.k,e.x],null,null),(n()(),e.rb(41,0,null,0,1,"ion-icon",[["src","../../../assets/image_icon/send.svg "]],null,null,null,i.fb,i.r)),e.qb(42,49152,null,0,a.C,[e.h,e.k,e.x],{src:[0,"src"]},null)],(function(n,l){var t=l.component;n(l,5,0,"md"),n(l,9,0,"chatList","chevron-back-outline","md",""),n(l,10,0,"chatList"),n(l,25,0,!0),n(l,27,0,t.chatMessages),n(l,31,0,"none ","md"),n(l,35,0,t.message),n(l,38,0,"Type your message... "),n(l,42,0,"../../../assets/image_icon/send.svg ")}),(function(n,l){n(l,22,0,l.component.chatUser.displayName),n(l,32,0,e.Cb(l,37).ngClassUntouched,e.Cb(l,37).ngClassTouched,e.Cb(l,37).ngClassPristine,e.Cb(l,37).ngClassDirty,e.Cb(l,37).ngClassValid,e.Cb(l,37).ngClassInvalid,e.Cb(l,37).ngClassPending)}))}function M(n){return e.Mb(0,[(n()(),e.rb(0,0,null,null,1,"app-chat",[],null,null,null,C,p)),e.qb(1,245760,null,0,b,[a.Gb,d.a,d.m,r.a,g.a,h.a,m.c],null,null)],(function(n,l){n(l,1,0)}),null)}var x=e.nb("app-chat",b,M,{},{},[]);class O{}t.d(l,"ChatPageModuleNgFactory",(function(){return P}));var P=e.ob(o,[],(function(n){return e.zb([e.Ab(512,e.j,e.Z,[[8,[s.a,x]],[3,e.j],e.v]),e.Ab(4608,u.m,u.l,[e.s,[2,u.v]]),e.Ab(4608,c.o,c.o,[]),e.Ab(4608,a.b,a.b,[e.x,e.g]),e.Ab(4608,a.Fb,a.Fb,[a.b,e.j,e.p]),e.Ab(4608,a.Jb,a.Jb,[a.b,e.j,e.p]),e.Ab(1073742336,u.c,u.c,[]),e.Ab(1073742336,c.n,c.n,[]),e.Ab(1073742336,c.e,c.e,[]),e.Ab(1073742336,a.Bb,a.Bb,[]),e.Ab(1073742336,d.o,d.o,[[2,d.t],[2,d.m]]),e.Ab(1073742336,O,O,[]),e.Ab(1073742336,o,o,[]),e.Ab(1024,d.k,(function(){return[[{path:"",component:b}]]}),[])])}))}}]);