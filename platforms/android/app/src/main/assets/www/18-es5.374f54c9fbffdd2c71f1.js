function _defineProperties(n,e){for(var l=0;l<e.length;l++){var o=e[l];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function _createClass(n,e,l){return e&&_defineProperties(n.prototype,e),l&&_defineProperties(n,l),n}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{CzNJ:function(n,e,l){"use strict";l.r(e);var o=l("8Y7J"),t=function n(){_classCallCheck(this,n)},i=l("pMnS"),a=l("MKJQ"),s=l("sZkV"),r=l("mrSG"),c=l("2Rin"),u=l("AytR"),h=l("lGQG"),d=l("Pn9U"),g=l("rKbp"),b=l("jBiw"),m=l("+/my"),p=l("JZFu"),v=l("4zgz"),f=function(){function n(e,l,o,t,i,a,s,r,c,h,d){var g=this;_classCallCheck(this,n),this.route=e,this.router=l,this.camera=o,this.util=t,this.alertController=i,this.authSVC=a,this.cameraPreview=s,this.videocallSVC=r,this.afDb=c,this.androidPermissions=h,this.zoomService=d,this.SDK_KEY="xqvI8YnZzEcm2wr4U0DYUl7eB90sPD2iiBjQ",this.SDK_SECRET="iQWxlbFuiEzn4zIJjP1xK1rAYS07uMmgTCiN",this.zoom=12,this.lat=28.6532358,this.lng=-106.0991318,this.styles=u.b,this.markers=[{img:this.authSVC.usersign.photoURL,select:!0,isOpen:!0,lat:28.6532358,lng:-106.0991318}],this.callActive=!1,console.log("ENTRO"),this.route.queryParams.subscribe((function(n){console.log(n,"PARAMS"),n&&n.special&&(g.callData=JSON.parse(n.special),g.user=g.callData.user,g.usercall=g.callData.usercall,g.data=g.callData)}))}return _createClass(n,[{key:"ngOnInit",value:function(){console.log(this.data),this.user=JSON.parse(sessionStorage.getItem("user")),this.status="Calling",this.getCall()}},{key:"openCamera",value:function(){var n=this,e={quality:100,destinationType:this.camera.DestinationType.FILE_URI,encodingType:this.camera.EncodingType.JPEG,mediaType:this.camera.MediaType.PICTURE};console.log(e),this.camera.getPicture(e).then((function(e){console.log(e);var l="data:image/jpeg;base64,"+e;console.log(l),n.img=l}),(function(n){}))}},{key:"openCam",value:function(){console.log("CAMARA"),this.openCamera()}},{key:"onMarkerSelect",value:function(n){return r.a(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.isOpen,!e.t0){e.next=7;break}return e.next=4,this.markers.forEach((function(n){n.select=!1}));case 4:return e.next=6,!0;case 6:n.select=e.sent;case 7:case"end":return e.stop()}}),e,this)})))}},{key:"presentAlert",value:function(){return r.a(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({cssClass:"my-custom-class",message:"Do you want to share your courrent location?",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(n){console.log("Confirm Cancel: blah")}},{text:"Share!",handler:function(){console.log("Confirm Okay")}}]});case 2:return e=n.sent,n.next=5,e.present();case 5:case"end":return n.stop()}}),n,this)})))}},{key:"startCamera",value:function(){var n=document.getElementById(""),e={x:0,y:0,width:+n.getAttribute("width"),height:+n.getAttribute("heigth"),camera:"rear",tapPhoto:!0,previewDrag:!0,toBack:!1,alpha:1};this.cameraPreview.startCamera(e).then((function(n){console.log(n)}),(function(n){console.log(n)}))}},{key:"startVideo",value:function(){var n={cameraDirection:"BACK",width:window.screen.width/2,height:window.screen.height/2,quality:60,withFlash:!1};this.cameraPreview.startRecordVideo(n).then((function(n){console.log(n)}))}},{key:"recordVideo",value:function(){}},{key:"initZoom",value:function(){var n=this;this.zoomService.initialize(this.SDK_KEY,this.SDK_SECRET).then((function(e){console.log(e),n.loginZoom()})).catch((function(n){return console.log(n)}))}},{key:"joinMeeting",value:function(){this.zoomService.joinMeeting("74695593469","phc5T9","CEL PEERRCOVERY",{no_driving_mode:!0,no_invite:!0,no_meeting_end_message:!0,no_titlebar:!1,no_bottom_toolbar:!1,no_dial_in_via_phone:!0,no_dial_out_to_phone:!0,no_disconnect_audio:!0,no_share:!0,no_audio:!0,no_video:!0,no_meeting_error_message:!0}).then((function(n){return console.log(n)})).catch((function(n){return console.log(n)}))}},{key:"initMeeting2",value:function(){var n="ivan.talamantes@live.com";console.log(n),this.zoomService.startMeetingWithZAK("123456789","CEL PEERRCOVERY","eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOm51bGwsImlzcyI6InNoV3FnYzVuUXlxSG9RRFFqWEpVYlEiLCJleHAiOjE2MTc3NTU1MDYsImlhdCI6MTYxNzc1MDEwNn0.jSv27DD6L8QBRwSdFiQU9usK1d6iv4zeo6xec7lm8Pw","eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJhdWQiOm51bGwsImlzcyI6InNoV3FnYzVuUXlxSG9RRFFqWEpVYlEiLCJleHAiOjE2MTc3NTU1MDYsImlhdCI6MTYxNzc1MDEwNn0.jSv27DD6L8QBRwSdFiQU9usK1d6iv4zeo6xec7lm8Pw",n,{no_driving_mode:!0,no_invite:!0,no_meeting_end_message:!0,no_titlebar:!1,no_bottom_toolbar:!1,no_dial_in_via_phone:!0,no_dial_out_to_phone:!0,no_disconnect_audio:!0,no_share:!0,no_audio:!0,no_video:!0,no_meeting_error_message:!0}).then((function(n){return console.log(n)})).catch((function(n){return console.log(n)}))}},{key:"loginZoom",value:function(){this.zoomService.login("losarcoscongregacion2020@gmail.com","LosArcos2020.").then((function(n){return console.log(n)})).catch((function(n){return console.log(n)}))}},{key:"initMeeting",value:function(){this.zoomService.startInstantMeeting({no_driving_mode:!0,no_invite:!0,no_meeting_end_message:!0,no_titlebar:!1,no_bottom_toolbar:!1,no_dial_in_via_phone:!0,no_dial_out_to_phone:!0,no_disconnect_audio:!0,no_share:!0,no_audio:!0,no_video:!0,no_meeting_error_message:!0}).then((function(n){return console.log(n)})).catch((function(n){return console.log(n)}))}},{key:"getCall",value:function(){var n=this;this.listener=this.videocallSVC.getCall(this.videocallSVC.keycall).once("value",(function(e){console.log(e.val()),n.call();var l=Object.keys(e.val().Members);console.log(l),console.log(e.val().Members[l[0]]),console.log(e.val().Members[l[1]]),e.val().Members[l[0]]&&e.val().Members[l[1]]&&(n.status="Ready")}))}},{key:"call",value:function(){console.log("Llamando"),this.recordedBlobs=new Array,this.setupWebRtc()}},{key:"setupWebRtc",value:function(){var n=this;this.senderId=this.guid(),console.log(this.senderId);var e="/webrtc/"+this.videocallSVC.keycall;console.log(e),this.channel=this.afDb.list(e),this.database=p.a.database().ref(e),this.database.on("child_added",this.readMessage.bind(this));try{this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:0.0.0.0:6200"}]},{optional:[]})}catch(l){console.log(l),this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:0.0.0.0:6200"}]},{optional:[]})}console.log(this.pc),this.pc.onicecandidate=function(e){console.log(e),e.candidate?n.sendMessage(n.senderId,JSON.stringify({ice:e.candidate})):console.log("Sent All Ice")},this.pc.onremovestream=function(n){console.log("Stream Ended")},this.pc.ontrack=function(e){return n.remote.nativeElement.srcObject=e.streams[0]},this.showMe(),"caller"==this.data.type&&this.showRemote()}},{key:"readMessage",value:function(n){var e=this;if(console.log(n,"DATA"),console.log(n.val(),"DATAs"),n)try{console.log(n.val().message);var l=JSON.parse(n.val().message);n.val(),n.val().sender!=this.senderId&&(null!=l.ice&&null!=this.pc?this.pc.addIceCandidate(new RTCIceCandidate(l.ice)):"offer"==l.sdp.type?(this.callActive=!0,this.pc.setRemoteDescription(new RTCSessionDescription(l.sdp)).then((function(){return e.pc.createAnswer()})).then((function(n){return e.pc.setLocalDescription(n)})).then((function(){return e.sendMessage(e.senderId,JSON.stringify({sdp:e.pc.localDescription}))}))):"answer"==l.sdp.type&&(this.callActive=!0,this.pc.setRemoteDescription(new RTCSessionDescription(l.sdp))))}catch(o){console.log(o)}}},{key:"sendMessage",value:function(n,e){this.channel.push({sender:n,message:e}).remove()}},{key:"ngOnDestroy",value:function(){}},{key:"guid",value:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}},{key:"s4",value:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}},{key:"handleDataAvailable",value:function(){var n=this;try{this.mediaRecorder.ondataavailable=function(e){e.data&&e.data.size>0&&n.recordedBlobs.push(e.data)}}catch(e){console.log(e)}}},{key:"onStopRecordingEvent",value:function(){var n=this;try{console.log("onstop"),this.mediaRecorder.onstop=function(e){var l=new Blob(n.recordedBlobs,{type:"video/webm"});n.downloadUrl=window.URL.createObjectURL(l),n.videocallSVC.tareaCloudStorage(n.videocallSVC.keycall+"/"+n.user.uid,l).percentageChanges().subscribe((function(n){Math.round(n)}))}}catch(e){console.log(e)}}},{key:"startRecording",value:function(n){this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(n)}catch(e){console.log("Try different mimeType",e)}console.log("Created MediaRecorder",this.mediaRecorder,"with options"),this.handleDataAvailable(),this.onStopRecordingEvent(),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}},{key:"stopRecording",value:function(){console.log("stop"),this.mediaRecorder.stop(),console.log("Recorded Blobs: ",this.recordedBlobs)}},{key:"showMe",value:function(){var n=this;console.log("showme"),this.androidPermissions.checkPermission(this.androidPermissions.PERMISSION.CAMERA).then((function(e){console.log(e,"RESULT"),navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){console.log(e,"STREAM"),n.me.nativeElement.srcObject=e,console.log(e,"STREAM2"),n.pc.addStream(e),console.log(e,"STREAM3"),n.localStream=e,console.log(n.localStream),n.startRecording(e)})).catch((function(n){console.log(JSON.stringify(n),"ERROR1")}))})).catch((function(n){console.log(n,"ERROR3")}))}},{key:"showRemote",value:function(){var n=this;console.log("Contesto");try{this.pc.createOffer().then((function(e){return n.pc.setLocalDescription(e)})).then((function(){n.sendMessage(n.senderId,JSON.stringify({sdp:n.pc.localDescription})),n.callActive=!0}))}catch(e){this.setupWebRtc(),console.log(e)}}},{key:"reconnect",value:function(){this.videocallSVC.reconnect(this.user,this.videocallSVC.keycall),this.showRemote()}},{key:"hangup",value:function(){this.videocallSVC.hangup(this.user,this.videocallSVC.keycall),console.log("Colgaron"),this.stopRecording(),this.pc.close();for(var n=this.localStream.getTracks(),e=0;e<n.length;e++)n[e].stop();this.callActive=!1,this.router.navigate(["video"])}}]),n}(),_=l("iInd"),y=l("bSaC"),C=o.pb({encapsulation:0,styles:[["ion-header[_ngcontent-%COMP%]   ion-back-button[_ngcontent-%COMP%]{color:var(--ion-color-primary-dark)}ion-header[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:var(--ion-color-primary-dark);text-align:center;font-size:18px;font-family:sfUi-m;text-transform:capitalize}.call-red[_ngcontent-%COMP%]{float:left;margin-top:25px}.call-green[_ngcontent-%COMP%]{float:right;margin-top:25px}.avatar[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto}ion-avatar[_ngcontent-%COMP%]{height:80px;width:80px}ion-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:80px;width:80px;border-radius:50%;border:2px solid var(--ion-color-white)}#background-content[_ngcontent-%COMP%]{background-color:red!important}ion-content[_ngcontent-%COMP%]   .bottom-content[_ngcontent-%COMP%]{position:absolute;bottom:0;margin:16px;width:91%}.pt-5[_ngcontent-%COMP%]{padding-top:10px}body[_ngcontent-%COMP%], html[_ngcontent-%COMP%], ion-app[_ngcontent-%COMP%], ion-content[_ngcontent-%COMP%]{background-color:transparent}.video[_ngcontent-%COMP%]{background-color:#0ff;position:absolute;top:0;margin:16px;width:91%}"]],data:{}});function k(n){return o.Mb(0,[o.Ib(402653184,1,{search:0}),o.Ib(671088640,2,{me:0}),o.Ib(671088640,3,{remote:0}),(n()(),o.rb(3,0,null,null,10,"ion-header",[["class","ion-no-border"]],null,null,null,a.eb,a.q)),o.qb(4,49152,null,0,s.B,[o.h,o.k,o.x],null,null),(n()(),o.rb(5,0,null,0,8,"ion-toolbar",[["mode","md"]],null,null,null,a.Bb,a.N)),o.qb(6,49152,null,0,s.zb,[o.h,o.k,o.x],{mode:[0,"mode"]},null),(n()(),o.rb(7,0,null,0,3,"ion-buttons",[["slot","end"]],null,null,null,a.T,a.f)),o.qb(8,49152,null,0,s.l,[o.h,o.k,o.x],null,null),(n()(),o.rb(9,0,null,0,1,"ion-menu-button",[],null,null,null,a.lb,a.y)),o.qb(10,49152,null,0,s.R,[o.h,o.k,o.x],null,null),(n()(),o.rb(11,0,null,0,2,"ion-title",[],null,null,null,a.zb,a.L)),o.qb(12,49152,null,0,s.xb,[o.h,o.k,o.x],null,null),(n()(),o.Kb(-1,0,["Video call"])),(n()(),o.rb(14,0,null,null,38,"ion-content",[],null,null,null,a.X,a.j)),o.qb(15,49152,null,0,s.u,[o.h,o.k,o.x],null,null),(n()(),o.rb(16,0,null,0,9,"ion-row",[],null,null,null,a.rb,a.D)),o.qb(17,49152,null,0,s.gb,[o.h,o.k,o.x],null,null),(n()(),o.rb(18,0,null,0,3,"ion-col",[],null,null,null,a.W,a.i)),o.qb(19,49152,null,0,s.t,[o.h,o.k,o.x],null,null),(n()(),o.rb(20,0,null,0,1,"h3",[],null,null,null,null,null)),(n()(),o.Kb(21,null,["",""])),(n()(),o.rb(22,0,null,0,3,"ion-col",[],null,null,null,a.W,a.i)),o.qb(23,49152,null,0,s.t,[o.h,o.k,o.x],null,null),(n()(),o.rb(24,0,null,0,1,"h3",[],null,null,null,null,null)),(n()(),o.Kb(25,null,[" "," "])),(n()(),o.rb(26,0,null,0,4,"div",[["style","position: relative; width: 100%; height: 100%;"]],null,null,null,null,null)),(n()(),o.rb(27,0,null,null,1,"div",[["style","border: solid; width: 100%; height: 100%; position: absolute; left: 0px; top: 0px;"]],null,null,null,null,null)),(n()(),o.rb(28,0,[[3,0],["remote",1]],null,0,"video",[["autoplay",""],["controls",""],["id","device"],["style","width: 100%; height: 100%;"]],null,null,null,null,null)),(n()(),o.rb(29,0,null,null,1,"div",[["style","border: solid; width: 30%; position: absolute; left: 65%; top: 10%;"]],null,null,null,null,null)),(n()(),o.rb(30,0,[[2,0],["me",1]],null,0,"video",[["autoplay",""],["controls",""],["id","me"],["style","width: 100%; height: 100%;"]],null,null,null,null,null)),(n()(),o.rb(31,0,null,0,0,"hr",[],null,null,null,null,null)),(n()(),o.rb(32,0,null,0,1,"ion-row",[],null,null,null,a.rb,a.D)),o.qb(33,49152,null,0,s.gb,[o.h,o.k,o.x],null,null),(n()(),o.rb(34,0,null,0,18,"div",[["class","bottom-content"]],null,null,null,null,null)),(n()(),o.rb(35,0,null,null,17,"ion-grid",[],null,null,null,a.db,a.p)),o.qb(36,49152,null,0,s.A,[o.h,o.k,o.x],null,null),(n()(),o.rb(37,0,null,0,15,"ion-row",[],null,null,null,a.rb,a.D)),o.qb(38,49152,null,0,s.gb,[o.h,o.k,o.x],null,null),(n()(),o.rb(39,0,null,0,5,"ion-col",[],null,null,null,a.W,a.i)),o.qb(40,49152,null,0,s.t,[o.h,o.k,o.x],null,null),(n()(),o.rb(41,0,null,0,3,"ion-fab-button",[["class","call-green"],["d",""]],null,[[null,"click"]],(function(n,e,l){var o=!0;return"click"===e&&(o=!1!==n.component.reconnect()&&o),o}),a.Z,a.m)),o.qb(42,49152,null,0,s.x,[o.h,o.k,o.x],null,null),(n()(),o.rb(43,0,null,0,1,"ion-icon",[["name","call-outline"]],null,null,null,a.fb,a.r)),o.qb(44,49152,null,0,s.C,[o.h,o.k,o.x],{name:[0,"name"]},null),(n()(),o.rb(45,0,null,0,1,"ion-col",[],null,null,null,a.W,a.i)),o.qb(46,49152,null,0,s.t,[o.h,o.k,o.x],null,null),(n()(),o.rb(47,0,null,0,5,"ion-col",[],null,null,null,a.W,a.i)),o.qb(48,49152,null,0,s.t,[o.h,o.k,o.x],null,null),(n()(),o.rb(49,0,null,0,3,"ion-fab-button",[["class","call-red"],["color","danger"]],null,[[null,"click"]],(function(n,e,l){var o=!0;return"click"===e&&(o=!1!==n.component.hangup()&&o),o}),a.Z,a.m)),o.qb(50,49152,null,0,s.x,[o.h,o.k,o.x],{color:[0,"color"]},null),(n()(),o.rb(51,0,null,0,1,"ion-icon",[["name","call-outline"]],null,null,null,a.fb,a.r)),o.qb(52,49152,null,0,s.C,[o.h,o.k,o.x],{name:[0,"name"]},null)],(function(n,e){n(e,6,0,"md"),n(e,44,0,"call-outline"),n(e,50,0,"danger"),n(e,52,0,"call-outline")}),(function(n,e){var l=e.component;n(e,21,0,l.user.displayName),n(e,25,0,l.usercall.displayName)}))}var R=o.nb("app-call",f,(function(n){return o.Mb(0,[(n()(),o.rb(0,0,null,null,1,"app-call",[],null,null,null,k,C)),o.qb(1,245760,null,0,f,[_.a,_.m,d.a,c.a,s.a,h.a,g.a,m.a,y.a,v.a,b.a],null,null)],(function(n,e){n(e,1,0)}),null)}),{},{},[]),w=l("SVse"),S=l("s7LF"),M=l("LSHg"),A=l("KJxK"),x=function n(){_classCallCheck(this,n)};l.d(e,"CallPageModuleNgFactory",(function(){return O}));var O=o.ob(t,[],(function(n){return o.zb([o.Ab(512,o.j,o.Z,[[8,[i.a,R]],[3,o.j],o.v]),o.Ab(4608,w.m,w.l,[o.s,[2,w.v]]),o.Ab(4608,S.o,S.o,[]),o.Ab(4608,s.b,s.b,[o.x,o.g]),o.Ab(4608,s.Fb,s.Fb,[s.b,o.j,o.p]),o.Ab(4608,s.Jb,s.Jb,[s.b,o.j,o.p]),o.Ab(4608,M.r,M.r,[]),o.Ab(4608,M.s,M.s,[]),o.Ab(4608,M.l,M.k,[[2,M.i],M.r,M.s,o.s]),o.Ab(1073742336,w.c,w.c,[]),o.Ab(1073742336,S.n,S.n,[]),o.Ab(1073742336,S.e,S.e,[]),o.Ab(1073742336,s.Bb,s.Bb,[]),o.Ab(1073742336,A.b,A.b,[]),o.Ab(1073742336,M.a,M.a,[]),o.Ab(1073742336,_.o,_.o,[[2,_.t],[2,_.m]]),o.Ab(1073742336,x,x,[]),o.Ab(1073742336,t,t,[]),o.Ab(1024,_.k,(function(){return[[{path:"",component:f}]]}),[]),o.Ab(256,M.i,{apiKey:"AIzaSyDL-2mFo6QYsp7qNSQl95AzhVZ6njRsLtE"},[])])}))}}]);